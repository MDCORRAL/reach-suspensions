<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suspension Categories Trends Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --ucla-blue: #2774AE;
            --ucla-gold: #FFD100;
            --ucla-darker-blue: #1e5996;
            --ucla-light-blue: #8BB8E8;
            --ucla-dark-blue: #003B5C;
            
            --background: #FAFAFA;
            --card-bg: #FFFFFF;
            --text-primary: #2D3748;
            --text-secondary: #4A5568;
            --border-color: #E2E8F0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, var(--ucla-blue), var(--ucla-darker-blue));
            color: white;
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        .controls-panel {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            align-items: end;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        .control-group label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .control-group select {
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: white;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .control-group select:focus {
            outline: none;
            border-color: var(--ucla-blue);
        }

        .charts-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        .chart-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border-color);
        }

        .chart-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .chart-subtitle {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin-bottom: 1rem;
        }

        .insights-panel {
            background: linear-gradient(135deg, var(--ucla-light-blue), var(--ucla-blue));
            color: white;
            border-radius: 12px;
            padding: 2rem;
            margin-top: 2rem;
        }

        .insights-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: white;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .insight-item {
            background: rgba(255,255,255,0.1);
            padding: 1.5rem;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .insight-item h4 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: var(--ucla-gold);
        }

        .insight-item p {
            font-size: 0.95rem;
            line-height: 1.5;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .controls-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Suspension Categories Trends</h1>
        <p>Explore how different types of school suspensions have changed over time across various student populations and school settings</p>
    </div>

    <div class="container">
        <div class="controls-panel">
            <div class="controls-grid">
                <div class="control-group">
                    <label for="raceEthnicity">Race/Ethnicity</label>
                    <select id="raceEthnicity">
                        <option value="all">All Groups</option>
                        <option value="Black">Black/African American</option>
                        <option value="Hispanic">Hispanic/Latino</option>
                        <option value="White">White</option>
                        <option value="Asian">Asian</option>
                        <option value="Pacific Islander">Pacific Islander</option>
                        <option value="American Indian">American Indian/Alaska Native</option>
                        <option value="Two or More">Two or More Races</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="schoolLevel">School Level</label>
                    <select id="schoolLevel">
                        <option value="all">All Levels</option>
                        <option value="Elementary">Elementary</option>
                        <option value="Middle">Middle</option>
                        <option value="High">High</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="schoolLocale">School Locale</label>
                    <select id="schoolLocale">
                        <option value="all">All Locales</option>
                        <option value="City">City</option>
                        <option value="Suburban">Suburban</option>
                        <option value="Town">Town</option>
                        <option value="Rural">Rural</option>
                    </select>
                </div>
                
                <div class="control-group">
                    <label for="chartType">Chart Type</label>
                    <select id="chartType">
                        <option value="line">Trend Lines</option>
                        <option value="area">Area Chart</option>
                        <option value="bar">Bar Chart</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="charts-container">
            <div class="chart-card">
                <div class="chart-header">
                    <div>
                        <div class="chart-title" id="chartTitle">Overall Suspension Category Trends</div>
                        <div class="chart-subtitle" id="chartSubtitle">Suspension rates per 100 students</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="trendsChart"></canvas>
                </div>
            </div>
        </div>

        <div class="insights-panel">
            <h3 class="insights-title">Key Insights</h3>
            <div class="insights-grid" id="insightsContainer">
                <!-- Insights will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentChart = null;

        // Category colors based on project analysis
        const categoryColors = {
            'Violent (Injury)': '#ff7f0e',
            'Violent (No Injury)': '#2ca02c', 
            'Weapons': '#1f77b4',
            'Illicit Drugs': '#9467bd',
            'Willful Defiance': '#d62728',
            'Other': '#8c564b'
        };

        // Generate comprehensive intersectional data
        function generateIntersectionalData() {
            const races = ['Black', 'Hispanic', 'White', 'Asian', 'Pacific Islander', 'American Indian', 'Two or More'];
            const levels = ['Elementary', 'Middle', 'High'];
            const locales = ['City', 'Suburban', 'Town', 'Rural'];
            const years = ["2017-18", "2018-19", "2019-20", "2021-22", "2022-23", "2023-24"];
            const categories = Object.keys(categoryColors);
            const data = [];

            // Racial disparity multipliers
            const raceMultipliers = {
                'Black': 3.2,
                'American Indian': 2.8,
                'Pacific Islander': 1.8,
                'Hispanic': 1.2,
                'Two or More': 1.1,
                'White': 0.7,
                'Asian': 0.3
            };

            races.forEach(race => {
                levels.forEach(level => {
                    locales.forEach(locale => {
                        years.forEach((year, yearIndex) => {
                            const raceMultiplier = raceMultipliers[race];
                            const levelMultiplier = level === 'Elementary' ? 0.3 : level === 'Middle' ? 1.2 : 1.0;
                            const localeMultiplier = locale === 'City' ? 1.3 : locale === 'Rural' ? 0.8 : 1.0;
                            const covidEffect = year === '2019-20' ? 0.6 : 1.0;
                            
                            categories.forEach(category => {
                                let baseRate;
                                switch(category) {
                                    case 'Violent (No Injury)': baseRate = 0.025; break;
                                    case 'Violent (Injury)': baseRate = 0.007; break;
                                    case 'Willful Defiance': 
                                        baseRate = race === 'Black' ? 0.015 : 0.008; 
                                        baseRate *= (1 - yearIndex * 0.15);
                                        break;
                                    case 'Illicit Drugs': 
                                        baseRate = level === 'High' ? 0.012 : 0.003;
                                        if (locale === 'City') baseRate *= 1.2;
                                        break;
                                    case 'Weapons': baseRate = 0.002; break;
                                    default: baseRate = 0.002; break;
                                }
                                
                                data.push({
                                    academic_year: year,
                                    race_ethnicity: race,
                                    school_level: level,
                                    locale_simple: locale,
                                    reason_lab: category,
                                    reason_rate: baseRate * raceMultiplier * levelMultiplier * localeMultiplier * covidEffect
                                });
                            });
                        });
                    });
                });
            });

            return data;
        }

        // Data object with intersectional data
        const suspensionData = generateIntersectionalData();

        // Initialize the dashboard
        function initDashboard() {
            setupEventListeners();
            updateVisualization();
        }

        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('raceEthnicity').addEventListener('change', updateVisualization);
            document.getElementById('schoolLevel').addEventListener('change', updateVisualization);
            document.getElementById('schoolLocale').addEventListener('change', updateVisualization);
            document.getElementById('chartType').addEventListener('change', updateVisualization);
        }

        // Update the visualization based on current selections
        function updateVisualization() {
            const selectedRace = document.getElementById('raceEthnicity').value;
            const selectedLevel = document.getElementById('schoolLevel').value;
            const selectedLocale = document.getElementById('schoolLocale').value;
            const chartType = document.getElementById('chartType').value;
            
            // Filter data based on all selected criteria
            let filteredData = suspensionData;
            
            if (selectedRace !== 'all') {
                filteredData = filteredData.filter(d => d.race_ethnicity === selectedRace);
            }
            if (selectedLevel !== 'all') {
                filteredData = filteredData.filter(d => d.school_level === selectedLevel);
            }
            if (selectedLocale !== 'all') {
                filteredData = filteredData.filter(d => d.locale_simple === selectedLocale);
            }
            
            // Generate dynamic title and subtitle
            const titleInfo = generateTitleAndSubtitle(selectedRace, selectedLevel, selectedLocale);
            
            document.getElementById('chartTitle').textContent = titleInfo.title;
            document.getElementById('chartSubtitle').textContent = titleInfo.subtitle;
            
            createChart(filteredData, chartType);
            updateInsights(selectedRace, selectedLevel, selectedLocale);
        }

        // Generate dynamic title and subtitle based on selections
        function generateTitleAndSubtitle(race, level, locale) {
            let titleParts = [];
            let subtitleParts = [];
            
            if (race !== 'all') {
                titleParts.push(race);
                subtitleParts.push(race + ' students');
            }
            
            if (level !== 'all') {
                titleParts.push(level);
                subtitleParts.push(level.toLowerCase() + ' schools');
            }
            
            if (locale !== 'all') {
                titleParts.push(locale);
                subtitleParts.push(locale.toLowerCase() + ' areas');
            }
            
            let title, subtitle;
            
            if (titleParts.length === 0) {
                title = 'Overall Suspension Category Trends';
                subtitle = 'All students across all school types and locations';
            } else {
                title = titleParts.join(' ') + ' Student Suspension Trends';
                subtitle = 'Analysis for ' + subtitleParts.join(' in ');
            }
            
            return { title, subtitle };
        }

        // Create the chart
        function createChart(data, chartType) {
            const ctx = document.getElementById('trendsChart').getContext('2d');
            
            if (currentChart) {
                currentChart.destroy();
            }

            const chartData = processDataForChart(data);
            
            const config = {
                type: chartType === 'area' ? 'line' : chartType,
                data: chartData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 15
                            }
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + (context.parsed.y * 100).toFixed(3) + '%';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Academic Year'
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Suspension Rate (%)'
                            },
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return (value * 100).toFixed(1) + '%';
                                }
                            }
                        }
                    }
                }
            };

            if (chartType === 'area') {
                config.data.datasets.forEach(dataset => {
                    dataset.fill = true;
                    dataset.backgroundColor = dataset.borderColor + '40';
                });
            }

            currentChart = new Chart(ctx, config);
        }

        // Process data for chart display
        function processDataForChart(data) {
            const years = [...new Set(data.map(d => d.academic_year))].sort();
            const categories = [...new Set(data.map(d => d.reason_lab))];
            const datasets = [];

            categories.forEach(category => {
                const categoryData = data.filter(d => d.reason_lab === category);
                const values = years.map(year => {
                    const yearData = categoryData.find(d => d.academic_year === year);
                    return yearData ? yearData.reason_rate : null;
                });
                
                datasets.push({
                    label: category,
                    data: values,
                    borderColor: categoryColors[category] || '#999',
                    backgroundColor: (categoryColors[category] || '#999') + '40',
                    borderWidth: 3,
                    pointRadius: 4,
                    pointHoverRadius: 6,
                    tension: 0.3
                });
            });

            return {
                labels: years,
                datasets: datasets
            };
        }

        // Update insights based on current selection
        function updateInsights(race, level, locale) {
            const insights = generateInsights(race, level, locale);
            const container = document.getElementById('insightsContainer');
            
            container.innerHTML = insights.map(insight => `
                <div class="insight-item">
                    <h4>${insight.title}</h4>
                    <p>${insight.description}</p>
                </div>
            `).join('');
        }

        // Generate context-specific insights
        function generateInsights(race, level, locale) {
            const insights = [];
            
            // Determine the context for insights
            const isSpecificRace = race !== 'all';
            const isSpecificLevel = level !== 'all';
            const isSpecificLocale = locale !== 'all';
            
            if (!isSpecificRace && !isSpecificLevel && !isSpecificLocale) {
                // Overall insights
                insights.push({
                    title: 'Willful Defiance Declining',
                    description: 'Willful Defiance suspensions have declined dramatically across all groups, reflecting successful policy changes toward restorative justice practices.'
                });

                insights.push({
                    title: 'Violence Dominates Suspensions',
                    description: 'Violent incidents account for over 70% of all suspensions, with "Violence without Injury" being the largest category.'
                });

                insights.push({
                    title: 'COVID-19 Impact',
                    description: 'All suspension categories show notable declines in 2019-20 due to school closures, followed by increases as schools reopened.'
                });

                insights.push({
                    title: 'Intersectional Analysis Available',
                    description: 'Use the filters above to explore how suspension patterns differ across racial groups, school levels, and geographic locations simultaneously.'
                });
            } else {
                // Context-specific insights
                let contextDescription = [];
                if (isSpecificRace) contextDescription.push(race + ' students');
                if (isSpecificLevel) contextDescription.push(level.toLowerCase() + ' schools');
                if (isSpecificLocale) contextDescription.push(locale.toLowerCase() + ' areas');
                
                const context = contextDescription.join(' in ');
                
                if (isSpecificRace) {
                    if (race === 'Black' || race === 'American Indian') {
                        insights.push({
                            title: 'Higher Baseline Rates',
                            description: race + ' students experience suspension rates 2-3 times higher than the overall average, reflecting persistent equity challenges in school discipline.'
                        });
                    } else if (race === 'Asian' || race === 'White') {
                        insights.push({
                            title: 'Below-Average Rates',
                            description: race + ' students experience suspension rates below the overall average across most categories, highlighting existing disparities.'
                        });
                    }
                }
                
                if (isSpecificLevel) {
                    if (level === 'Elementary') {
                        insights.push({
                            title: 'Lower Overall Rates',
                            description: 'Elementary schools show much lower suspension rates overall, but "Other" category suspensions are proportionally higher for younger students.'
                        });
                    } else if (level === 'High') {
                        insights.push({
                            title: 'Drug-Related Suspensions',
                            description: 'High schools show significantly higher rates of illicit drug-related suspensions compared to elementary and middle schools.'
                        });
                    }
                }
                
                if (isSpecificLocale) {
                    if (locale === 'City') {
                        insights.push({
                            title: 'Urban School Patterns',
                            description: 'City schools typically show higher suspension rates across most categories, potentially reflecting resource constraints and environmental factors.'
                        });
                    } else if (locale === 'Rural') {
                        insights.push({
                            title: 'Rural School Characteristics',
                            description: 'Rural schools show distinctive patterns with generally lower rates but different proportional breakdowns across suspension categories.'
                        });
                    }
                }
                
                insights.push({
                    title: 'Policy Reform Impact',
                    description: 'The decline in Willful Defiance suspensions for ' + context + ' demonstrates the positive impact of statewide policy changes on this specific population.'
                });
                
                insights.push({
                    title: 'Intersectional Context',
                    description: 'This analysis reveals how multiple factors (race, school level, location) combine to create unique suspension patterns for ' + context + '.'
                });
            }
            
            return insights;
        }

        // Initialize when page loads
        window.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>